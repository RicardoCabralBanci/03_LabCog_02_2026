```vba
Attribute VB_Name = "CIP"
Option Explicit
Const template = "\manual.dotm"
Private Function createDoc(ByVal Path As String) As Word.Document
    
    Dim objword As Word.Application, objDoc As Word.Document, dlgSaveAs As FileDialog
    
    Set objword = New Word.Application
    Set objDoc = objword.Documents.Add
    Set dlgSaveAs = objword.FileDialog(msoFileDialogSaveAs)
    
    With dlgSaveAs
    .FilterIndex = 16: .InitialFileName = Path '16=.docx
    End With

    If Not dlgSaveAs.Show Then
        objDoc.Close: objword.Quit
        Set objDoc = Nothing
        Application.Visible = True: Application.ScreenUpdating = True: Application.Calculation = xlCalculationAutomatic: Application.EnableEvents = True
        Exit Function
    End If
    
    objDoc.SaveAs2 (dlgSaveAs.SelectedItems(1))
    
    Set createDoc = objDoc

End Function

Sub Manual(Optional byDummy As Byte)

On Error GoTo CloseEverything
'On Error GoTo 0

    'Definitions
    Dim objword As Word.Application
    Dim objDoc As Word.Document, objTempDoc As Word.Document
    Dim objSection As Word.Section
    Dim objTOC As Word.TableOfContents, objTOF As Word.TableOfFigures
    Dim templatepath As String, fileobjTempDoc As String, Path As String, file As String
    Dim docrange As Word.Range
    Dim i As Integer, lp As Integer
    
    'Just to pop up later
    Application.Visible = False: Application.ScreenUpdating = False: Application.Calculation = xlCalculationManual: Application.EnableEvents = False

    'File name
    Path = ActiveWorkbook.Path & "\"
    If Planilha3.Range("B540") = "Yes" Then
    file = Path & "BA_" & Info.Projeto & "_IHM_PT_" & Info.Revisao
    Else: file = Path & "BA_" & Info.Projeto & "_Innopro_PT_" & Info.Revisao: End If
    
    'Create new doc
    Set objDoc = createDoc(file)
    
    'Check if ok, close if error
    If objDoc Is Nothing Then Exit Sub
    
    'Set application
    Set objword = objDoc.Application
    objword.Visible = False
    
    'Set template
    templatepath = "V:\Abteilungen\SaoPaulo\PQK-M\Extern\Config_BA" & template
    If templatepath = vbNullString Then
    templatepath = ThisWorkbook.Path & template: End If
    If Dir(templatepath) <> vbNullString Then
        objDoc.AttachedTemplate = templatepath: objDoc.CopyStylesFromTemplate templatepath: End If
    
    'Rows loop
    For i = 538 To 648
        
        'IHM update Case Conditional
        If Planilha3.Range("B540") = "Yes" Then   'IHM yes + 1 row
            Select Case i
            Case 541 To 616, 631 To 647 'IHM yes + 1 to before Chapter 5 start, After Chapter 5 end to "Contra capa" -1
                'Do nothing
            Case Else: GoTo Generate: End Select: End If
        
        If Planilha3.Range("B540") = "No" Then
        GoTo Generate: End If
        
        GoTo LoopEnd
        
Generate:
        'Loop conditional
        If Planilha3.Range("B" & i) = "Yes" Then
    
            'Set files
            fileobjTempDoc = Planilha3.Range("C" & i).Value 'If B Yes and C empty code breaks, can activate on error resume next to ignore
            Set objTempDoc = objword.Documents.Open(Filename:=fileobjTempDoc, ReadOnly:=True, AddToRecentFiles:=False)
    
            'Set Headers and Footers
            Set objSection = objDoc.Range.Sections.Last
            With objSection
                .Headers(wdHeaderFooterPrimary).LinkToPrevious = False: .Footers(wdHeaderFooterEvenPages).LinkToPrevious = False
            End With
    
            'Copy properties & Setup
            Call CopyProperty(objTempDoc, objDoc)
            Call CopySetup(objTempDoc, objSection)
    
            'Insert file
            Set docrange = objDoc.Range
            docrange.Collapse wdCollapseEnd: docrange.InsertFile Filename:=objTempDoc.FullName
           
            'Pagebreak
            Set docrange = objTempDoc.Content
            docrange.Find.Execute findtext:="Quebra de pgina"
            If docrange.Find.Found = False Then
                Set docrange = objDoc.Range
                docrange.Collapse wdCollapseEnd: docrange.InsertBreak Type:=wdSectionBreakNextPage: End If
        
        'Close Source doc
        objTempDoc.Close wdDoNotSaveChanges
        
        'End conditional
        End If
               
        
        'Clear doc object
        Set objTempDoc = Nothing
        
LoopEnd:
    'End loop
    Next i
    
    UpdateCustomProperties objDoc
             
    'Update tables
        Call TableSub(objDoc, objword)
        
    'Update Image subs
    For Each objTOF In objDoc.TablesOfFigures: objTOF.Update: Next
        
    'Update page and date
    With objDoc
        For i = 3 To .Sections.Count - 1
            .Sections(i).Headers(wdHeaderFooterPrimary).PageNumbers.IncludeChapterNumber = False
            .Sections(i).Footers(wdHeaderFooterPrimary).Range.Fields.Update
        Next
    End With
    
    ' Update all fields and table of contents
    For Each objTOC In objDoc.TablesOfContents: objTOC.Update: Next: objDoc.Fields.Update
    
    'Keep Chapter start on odd page number
    Dim pr As Word.Paragraph

    For Each objSection In objDoc.Range.Sections
    Wait (0.2)
        Set pr = objSection.Range.Paragraphs.first
        If pr.Style = "Ttulo 1" Then
            i = pr.Range.Information(wdActiveEndPageNumber)
            If i Mod 2 = 0 Then
                Set docrange = pr.Range
                docrange.Collapse wdCollapseStart: docrange.InsertBreak wdSectionBreakNextPage
            End If
        End If
    Next
    
    Wait (1)
    
    'Contra capa handling
    With objDoc
        i = .Sections.Count - 1
        .Sections(i).Range.Paragraphs.Last.Range.Collapse wdCollapseEnd
        lp = .Sections(i).Range.Paragraphs.Last.Range.Information(wdActiveEndPageNumber)
        If lp Mod 2 <> 0 Then
            .Sections(i).Range.Paragraphs.Last.Range.InsertBreak wdSectionBreakNextPage
        End If
    End With
    
    'Blank page left intentionally
    With objDoc
        For i = 4 To .Sections.Count - 1
            Set docrange = .Sections(i).Range
            If Len(docrange.Text) <= 1 Then
                docrange.Style = "normal": docrange.Collapse wdCollapseStart: .AttachedTemplate.BuildingBlockEntries("BlankPage").Insert docrange
            End If
        Next
    End With
    
    ' Update all fields and table of contents
    For Each objTOC In objDoc.TablesOfContents: objTOC.Update: Next: objDoc.Fields.Update
    
    ' Finalize changes
    If Not objTempDoc Is Nothing Then objTempDoc.Close
        
    'Replace prep
    With Planilha2
    .Range("E2").ClearContents: .Range("D4:G20").ClearContents: .Range("E2") = objDoc.FullName
    End With
    
    'Choose your fate
    Dim answer As Integer
    
    objword.ActiveWindow.Selection.GoTo wdGoToPage, wdGoToFirst: objDoc.Save
    
    Application.Visible = True: Application.Calculation = xlCalculationAutomatic: Application.EnableEvents = True
        
    answer = MsgBox("Manual gerado com sucesso, deseja revisar agora?", vbQuestion + vbYesNo + vbDefaultButton2, "Finalizado com sucesso")
    
    If answer = vbYes Then
        
    objword.Visible = True: objword.Activate: objword.WindowState = wdWindowStateMaximize
    
    On Error GoTo exitsub
    
    Else: objDoc.Close
    Set objDoc = Nothing
    For Each objDoc In objword.Documents: objDoc.Close wdDoNotSaveChanges: Next: objword.Quit
            
    'If close and wait revision
    MsgBox "Manual gerado na pasta selecionada, favor revisar assim que possvel!", vbExclamation + vbOKOnly, "Reviso pendente": End If
        
    On Error GoTo exitsub
        
    Exit Sub
    
'Uppon error quit
CloseEverything:
    Application.Visible = True: Application.ScreenUpdating = True: Application.Calculation = xlCalculationAutomatic: Application.EnableEvents = True
    If Not objword Is Nothing Then objword.Visible = True
    If Not objTempDoc Is Nothing Then objTempDoc.Close
    MsgBox "Infelizmente um erro ocorreu, tente novamente ou entre em contato com o responsvel.", vbCritical + vbOKOnly, "Erro  :("
    On Error GoTo 0
    Exit Sub
    
'Blank VBA error handler
exitsub:
    
End Sub

Private Sub CopySetup(ByRef Source As Word.Document, ByRef Dest As Variant)
' COPYSETUP: Copies page settings from source to destination
    
    If TypeName(Dest) = "Document" Then
        CopyPageSetup Source.Sections.first.PageSetup, Dest.Sections.Last.PageSetup
    ElseIf TypeName(Dest) = "Section" Then
        CopyPageSetup Source.Sections.first.PageSetup, Dest.PageSetup
    Else: MsgBox "Invalid Destination Parameter", vbExclamation: End If

End Sub

Private Sub CopyPageSetup(ByRef Source As Word.PageSetup, ByRef Dest As Word.PageSetup)
' COPYPAGESETUP: Copies page settings from source to dest
With Dest
    .LineNumbering.Active = Source.LineNumbering.Active: .Orientation = Source.Orientation: .TopMargin = Source.TopMargin
    .BottomMargin = Source.BottomMargin: .LeftMargin = Source.LeftMargin: .RightMargin = Source.RightMargin: .Gutter = Source.Gutter
    .HeaderDistance = Source.HeaderDistance: .FooterDistance = Source.FooterDistance: .PageWidth = Source.PageWidth: .PageHeight = Source.PageHeight
    .FirstPageTray = Source.FirstPageTray: .OtherPagesTray = Source.OtherPagesTray: .OddAndEvenPagesHeaderFooter = Source.OddAndEvenPagesHeaderFooter
    .DifferentFirstPageHeaderFooter = Source.DifferentFirstPageHeaderFooter: .SuppressEndnotes = Source.SuppressEndnotes: .MirrorMargins = Source.MirrorMargins
End With
    
End Sub

Private Sub CopyProperty(ByRef Source As Word.Document, ByRef Dest As Word.Document)
    Dim srcProperty As Variant
    
    For Each srcProperty In Source.CustomDocumentProperties
        If CDPExists(srcProperty.Name, Dest) Then GoTo Continue
        Dest.CustomDocumentProperties.Add Name:=srcProperty.Name, LinkToContent:=False, Value:=srcProperty.Value, Type:=msoPropertyTypeString
Continue:
    Next

End Sub

Private Function CDPExists(ByVal CDPName As String, ByRef objDoc As Word.Document) As Boolean
    Dim objCDP As Variant
    For Each objCDP In objDoc.CustomDocumentProperties
        If objCDP.Name = CDPName Then
            CDPExists = True
            Exit Function
        End If
    Next
    
    CDPExists = False
End Function

Private Sub UpdateCDP(ByVal CDPName As String, ByRef objDoc As Word.Document, ByVal Value As String)

If Not CDPExists(CDPName, objDoc) Then Exit Sub

objDoc.CustomDocumentProperties(CDPName) = Value

End Sub

Private Sub UpdateCustomProperties(ByRef objDoc As Word.Document)
    
    UpdateCDP "MachineType", objDoc, "CIP": UpdateCDP "MachineModel", objDoc, Info.Maquina
    UpdateCDP "MachineNumber", objDoc, Info.NrMaquina: UpdateCDP "Order", objDoc, Info.Projeto
    UpdateCDP "Revision", objDoc, Info.Revisao: UpdateCDP "MachineYear", objDoc, Info.Ano
End Sub

Private Sub TableSub(ByRef objDoc As Word.Document, objword As Word.Application)

Dim erng As Excel.Range
Dim oRng As Word.Range, nRng As Word.Range
Dim oDoc As Word.Document
Dim ntable As Word.table, oTable As Word.table
Dim i As Integer

On Error GoTo hand

    Set oDoc = objword.Documents.Add
    
    For Each oTable In objDoc.Tables
            
            'Tables sub
            If oTable.Title = "Componentes integrados" Then
            
                Set erng = Planilha4.Range("B2:D" & Planilha4.Range("B" & Rows.Count).End(xlUp).Row)
                erng.Copy
                Wait (1)
                                
                'Formatting
                Set nRng = oDoc.Range
                nRng.PasteExcelTable False, False, False
                
                Application.CutCopyMode = False
                
                Set ntable = oDoc.Tables(1)
                
                Call format(ntable, objword)
                
                With ntable.Rows(2)
                    .HeadingFormat = True
                    With .Range
                        .Font.Size = "10": .Font.Bold = True: .ParagraphFormat.Alignment = wdAlignParagraphCenter
                    End With
                End With
                
                'Paste formated table
                Set nRng = ntable.Range
                nRng.Copy
                                                
                Set oRng = oTable.Range
                oTable.Delete
                
                Wait (1)

                oRng.Paste: nRng.Delete
                
                'To get another table
                GoTo Handling
                            
            End If
            
            If oTable.Title = "Receitas" Then
                Set erng = Planilha2.Range("A40:B" & Planilha2.Cells(40, 1).End(xlDown).Row)
                erng.Copy
                Wait (1)
                                
                'Formatting
                Set nRng = oDoc.Range
                nRng.PasteExcelTable False, False, False
                
                Application.CutCopyMode = False
                
                Set ntable = oDoc.Tables(1)
                
                Call format(ntable, objword)
                
                'Paste formated table
                Set nRng = ntable.Range
                nRng.Copy
                                                
                Set oRng = oTable.Range
                oTable.Delete
                
                Wait (1)

                oRng.Paste: nRng.Delete
                
                'To get another table
                GoTo Handling
                            
            End If
            
            If oTable.Title = "Dimenses gerais" Then
                Set erng = Planilha32.Range("B4:D7")
                erng.Copy
                Wait (1)
                                
                'Formatting
                Set nRng = oDoc.Range
                nRng.PasteExcelTable False, False, False
                
                Application.CutCopyMode = False
                
                Set ntable = oDoc.Tables(1)
                
                Call format(ntable, objword)
                
                With ntable.Range
                For i = 1 To .Cells.Count
                    If .Cells(i).ColumnIndex > 1 Then
                        .Cells(i).Range.ParagraphFormat.Alignment = wdAlignParagraphCenter
                    End If
                Next
                
                .Columns(1).PreferredWidth = 50
                End With
                
                'Paste formated table
                Set nRng = ntable.Range
                nRng.Copy
                                                
                Set oRng = oTable.Range
                oTable.Delete
                
                Wait (1)

                oRng.Paste: nRng.Delete
                
                'To get another table
                GoTo Handling
            
            End If
            
            If oTable.Title = "Peso" Then
                Set erng = Planilha32.Range("B10:D12")
                erng.Copy
                Wait (1)
                                
                'Formatting
                Set nRng = oDoc.Range
                nRng.PasteExcelTable False, False, False
                
                Application.CutCopyMode = False
                
                Set ntable = oDoc.Tables(1)
                
                Call format(ntable, objword)
                
                With ntable.Range
                For i = 1 To .Cells.Count
                    If .Cells(i).ColumnIndex > 1 Then
                        .Cells(i).Range.ParagraphFormat.Alignment = wdAlignParagraphCenter
                    End If
                Next
                
                .Columns(1).PreferredWidth = 50
                End With
                
                'Paste formated table
                Set nRng = ntable.Range
                nRng.Copy
                                                
                Set oRng = oTable.Range
                oTable.Delete
                
                Wait (1)

                oRng.Paste: nRng.Delete
                
                'To get another table
                GoTo Handling
            
            End If
            
            If oTable.Title = "Capacidades" Then
                Set erng = Planilha32.Range("B15:D" & Planilha32.Cells(15, 3).End(xlDown).Row)
                erng.Copy
                Wait (1)
                                
                'Formatting
                Set nRng = oDoc.Range
                nRng.PasteExcelTable False, False, False
                
                Application.CutCopyMode = False
                
                Set ntable = oDoc.Tables(1)
                
                Call format(ntable, objword)
                
                With ntable.Range
                For i = 1 To .Cells.Count
                    If .Cells(i).ColumnIndex > 1 Then
                        .Cells(i).Range.ParagraphFormat.Alignment = wdAlignParagraphCenter
                    End If
                Next
                
                .Columns(1).PreferredWidth = 50
                End With
                
                'Paste formated table
                Set nRng = ntable.Range
                nRng.Copy
                                                
                Set oRng = oTable.Range
                oTable.Delete
                
                Wait (1)

                oRng.Paste: nRng.Delete
                
                'To get another table
                GoTo Handling
            
            End If
            
            If oTable.Title = "Volume dos tanques" Then
                Set erng = Planilha32.Range("F4:I" & Planilha32.Cells(4, 8).End(xlDown).Row)
                erng.Copy
                Wait (1)
                                
                'Formatting
                Set nRng = oDoc.Range
                nRng.PasteExcelTable False, False, False
                
                Application.CutCopyMode = False
                
                Set ntable = oDoc.Tables(1)
                ntable.Title = "s"
                
                Call format(ntable, objword)
                
                With ntable.Range
                For i = 1 To .Cells.Count
                    If .Cells(i).ColumnIndex > 1 Then
                        .Cells(i).Range.ParagraphFormat.Alignment = wdAlignParagraphCenter
                    End If
                Next
                
                .Columns(1).PreferredWidth = 50
                End With
                
                'Paste formated table
                Set nRng = ntable.Range
                nRng.Copy
                                                
                Set oRng = oTable.Range
                oTable.Delete
                
                Wait (1)

                oRng.Paste: nRng.Delete
                
                'To get another table
                GoTo Handling
            
            End If
        
Handling:
    Next
    
    'close doc
    oDoc.Close wdDoNotSaveChanges
    
    Exit Sub

hand:
Wait (1)
Resume
                       
End Sub

Function Wait(ByVal Seconds As Single)
    Dim CurrentTimer As Variant
    CurrentTimer = Timer
    Do While Timer < CurrentTimer + Seconds
    Loop
End Function

Sub format(ByRef ntable As Word.table, objword As Word.Application)

        With ntable
                .PreferredWidthType = wdPreferredWidthPoints: .PreferredWidth = objword.CentimetersToPoints(15)
                .Rows.Height = objword.CentimetersToPoints(0.75): .AutoFitBehavior (wdAutoFitWindow)
                
            With .Borders
                .InsideLineStyle = wdLineStyleSingle: .InsideLineWidth = wdLineWidth225pt: .InsideColor = wdColorWhite
                .OutsideLineStyle = wdLineStyleSingle: .OutsideLineWidth = wdLineWidth225pt: .OutsideColor = wdColorWhite
            End With
            
            With .Range
                .Style = "normal": .Font.Name = "Arial": .Font.Size = "11": .ParagraphFormat.SpaceBefore = (3): .ParagraphFormat.SpaceAfter = (3)
                .ParagraphFormat.RightIndent = objword.CentimetersToPoints(0.1): .ParagraphFormat.LeftIndent = objword.CentimetersToPoints(0.1)
                .Cells.VerticalAlignment = wdCellAlignVerticalCenter: .ParagraphFormat.Alignment = wdAlignParagraphLeft
            End With
            
            With .Rows(1)
                .HeadingFormat = True
                With .Range
                    .Font.Bold = True: .ParagraphFormat.Alignment = wdAlignParagraphCenter
                End With
            End With
        End With

End Sub
```