# Arquitetura Híbrida V5: O Modelo de Ponte Geográfica

**Data de Registro**: 2026-01-13
**Status**: Operacional
**Responsável**: [[004. Mestre em VBA]]

## 1. Visão Geral
O sistema abandonou a manipulação direta do Word via VBA (COM). A lógica de montagem agora reside em uma **Engine C# externa** (`NewGeradorV2.exe`), enquanto o Excel atua estritamente como **Interface de Seleção (Frontend)** e **Gerador de Manifesto**.

### O Fim da Era Legada
Os módulos antigos de lógica individual (`mod_CCMX.bas`, `mod_BTR.bas`, `mod_GTR.bas`, etc.) foram **DELETADOS** e substituídos integralmente pelo `mod_NewEngine_V5.bas`. O Excel não contém mais código para abrir, ler ou montar documentos Word. Toda essa responsabilidade foi transferida para a Engine C#.

## 2. O Fluxo de Dados (Corrigido)
1.  **Interação (UI Distribuída)**: O usuário navega nas abas específicas de cada máquina (ex: `PLT Estrutura` - Planilha 43, `PLT Elétrica` - Planilha 46). Nestas abas, ele marca com "X" as opções desejadas nas tabelas visuais.
2.  **Sincronização**: Estas abas de interface alimentam (via fórmulas ou eventos) a aba mestre oculta `Base de Dados` (ou `Dados Salvos`), consolidando o estado de todas as seleções.
3.  **Disparo**: O usuário clica no botão "Gerar Manual" no menu principal.
4.  **Extração Centralizada**: O módulo `mod_NewEngine_V5` lê exclusivamente a aba `Base de Dados`. Ele ignora as abas de UI. Ele varre a lista consolidada e identifica:
    *   `MACHINE_TYPE`: O parâmetro passado pelo botão.
    *   `FILES`: Caminhos cujas linhas correspondentes na Base de Dados estão marcadas como "YES/X/TRUE".
5.  **Manifesto**: É gerado o arquivo `input_manifest.csv`.
6.  **Execução**: O C# é acionado com este manifesto.

## 3. Estrutura do Manifesto (input_manifest.csv)
O arquivo segue o padrão `CATEGORY;KEY;VALUE`:
- `META;EXPORT_DATE;YYYY-MM-DD HH:MM:SS`
- `META;MACHINE_TYPE;[TIPO]`
- `FILE;[ROW_INDEX];[FILE_PATH]`

## 4. Regras Geográficas (O Segredo do Filtro)
A Engine C# utiliza o `ROW_INDEX` para saber a qual seção do manual o arquivo pertence.
*   **Slots Atuais**:
    *   `38 - 42`: CCMX (Padrão Ouro)
*   **Novos Slots (Planejados)**:
    *   `43 - 47`: Paletizador (PLT)
    *   `48 - 52`: Encaixotadora (PCK)

## 5. Vantagens Técnicas
*   **Independência de Local**: Usa `ThisWorkbook.Path`, eliminando o drive `V:`.
*   **Performance**: O C# processa strings e arquivos muito mais rápido que o VBA.
*   **Estabilidade**: Se o gerador travar, o Excel continua vivo.

---
*“O VBA agora é o garçom que anota o pedido; o C# é o chef que cozinha na cozinha profissional.”*
