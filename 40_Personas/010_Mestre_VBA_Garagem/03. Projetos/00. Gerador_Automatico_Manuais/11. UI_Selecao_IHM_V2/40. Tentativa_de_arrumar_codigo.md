# Relatório de Refinamento e Fixes (UI V2.1)

**Data**: 02/02/2026
**Objetivo**: Corrigir falhas visuais e de comportamento detectadas no primeiro teste prático ("Run 1").

---

## 1. Diagnóstico de Problemas (O que deu errado?)

### A. "Fantasmas" na Galeria (Crítico)
*   **Sintoma**: Ao desmarcar um filtro (ex: desligar Siemens), o fundo do card some, mas os textos ("TP1200", "WinCC") e badges continuam flutuando na tela.
*   **Causa Raiz**: O código atual usa `ws.Shapes(s.Name).Delete` mas o filtro de deleção `If s.Name Like "card_*"` pode estar falhando em pegar os sub-elementos (textboxes e badges) se eles não tiverem o prefixo correto no nome.
*   **Solução Proposta**: Implementar a lógica de **Agrupamento (Group)**. Ao criar o card, agrupar todos os shapes (Fundo + Texto + Badges) em um único objeto `Group`. Assim, ao deletar o grupo, tudo some junto.

### B. Invasão da Zona Corporativa (Layout)
*   **Sintoma**: A interface começa muito no topo.
*   **Requisito**: As linhas 1, 2 e 3 são reservadas para Cabeçalho/Logo da empresa.
*   **Solução**: Ajustar a constante `ROW_START` ou `topPos` inicial para começar a desenhar a partir da **Linha 5** (aprox. `Range("A5").Top`).

### C. Alinhamento Botão x Célula (Grid Controlado)
*   **Sintoma**: Os botões da Sidebar estão com tamanho fixo arbitrário, desalinhando das linhas.
*   **Solução**: Controle total do Grid na `Init_UI`.
    *   Definir altura explícita para linhas de botões (ex: Linhas 5, 7, 9 terão `RowHeight = 45`).
    *   O botão lê a altura da linha (`btn.Height = Range("A5").Height - 2`).
    *   Isso garante alinhamento pixel-perfect.

### D. Validação de Imagens (Load Real)
*   **Sintoma**: Precisamos saber se o caminho da imagem no DB está correto e se o tamanho está bom.
*   **Solução**:
    *   Tentar carregar o arquivo real usando `Shapes.AddPicture(Filename:=...)`.
    *   **Fallback**: Se o arquivo não for encontrado (Erro 1004), desenhar um retângulo com um "X" vermelho e o texto "IMG 404".
    *   Isso serve como ferramenta de diagnóstico para você ver quais imagens estão faltando na pasta.

---

## 2. Plano de Ação (VBA V2.2)

### Passo 1: Ajuste de Coordenadas e Grid
Alterar a `Init_UI` para configurar `ws.Rows("5:100").RowHeight` e começar o desenho na Linha 5.

### Passo 2: Refatoração do Construtor de Card (Grouping)
Alterar a função `Draw_Rich_Card`:
1.  Criar os shapes individuais.
2.  **Imagem**: Usar `AddPicture` com `LinkToFile:=msoFalse, SaveWithDocument:=msoTrue`.
3.  Agrupar tudo (`Selection.ShapeRange.Group`).
4.  Nomear o grupo final como `grp_card_[ID]`.
5.  **A Deleção**: O loop de limpeza passará a procurar apenas por `grp_card_*`.

### Passo 3: Placeholder Rico
Substituir o retângulo cinza simples por um "Monitorzinho":
*   Retângulo Externo (Borda Monitor).
*   Retângulo Interno (Tela Azulada).
*   Trapézio (Base).

---

## 3. Checklist de Validação
- [ ] Linhas 1-3 Livres?
- [ ] Ao desligar filtro, o card some *completamente*?
- [ ] Botão da Sidebar ocupa exatamente a altura da célula (menos margem)?
- [ ] Placeholder parece um monitor?
