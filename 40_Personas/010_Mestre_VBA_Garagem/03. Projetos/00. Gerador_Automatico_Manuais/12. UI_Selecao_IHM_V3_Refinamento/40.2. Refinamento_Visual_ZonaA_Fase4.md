# Refinamento Visual: Fase 4 (Alinhamento & Guerra aos Filtros Azuis)

**Objetivo**: Garantir que os Filtros da Sidebar reflitam o estado real (On/Off) e que a linha de cabe√ßalho seja uma unidade visual s√≥lida.

---

## üìã Lista de Problemas (Checklist)

- [x] **1. Cabe√ßalho (Linha 4)**: A cor de fundo da c√©lula **A4** deve ser replicada nas c√©lulas **B4 at√© P4**. Sem shapes, apenas preenchimento de c√©lula.
- [x] **2. Filtros "Teimosos" (Azul Degrad√™)**: Os bot√µes de filtro na Sidebar ignoram o cinza e insistem no azul padr√£o do Excel.
- [x] **3. Feedback de Sele√ß√£o (Toggle)**: Ao clicar em "SIEMENS", por exemplo, o bot√£o n√£o muda de cor para indicar que foi ativado/desativado.
    *   *Causa Prov√°vel*: Os bot√µes novos est√£o sendo criados **em cima** dos antigos. O que voc√™ v√™ √© sempre uma nova camada de bot√µes "padr√£o azul", enquanto o c√≥digo talvez esteja tentando formatar os bot√µes que ficaram enterrados embaixo.

---

## üõ†Ô∏è Solu√ß√µes T√©cnicas Detalhadas

### 1. Sincroniza√ß√£o do Cabe√ßalho (A4 -> P4)
N√£o usaremos mais um Shape para o t√≠tulo "Cat√°logo". Usaremos as pr√≥prias c√©lulas do Excel.
*   **A√ß√£o**: O c√≥digo deve ler `Range("A4").Interior.Color` e aplic√°-lo ao `Range("B4:P4")`.
*   **Vantagem**: Alinhamento perfeito com o texto das c√©lulas e sem objetos "flutuando" no t√≠tulo.

### 2. O Exorcismo do Azul (Reset de Estilo)
Para garantir que o cinza apare√ßa, precisamos "resetar" o estilo do shape antes de pint√°-lo.
*   **A√ß√£o**: No VBA, al√©m de definir a cor, precisamos definir o preenchimento como **S√≥lido** (`.Solid`) e remover explicitamente o **Bisel/3D** e o **Gradiente**.
*   **Snippet**:
    ```vba
    With shp.Fill
        .Solid ' <--- Mata o degrad√™ padr√£o
        .ForeColor.RGB = CLR_BTN_ACTIVE
    End With
    shp.Line.Visible = msoFalse ' Remove a borda azul fina
    shp.ThreeD.BevelTopType = msoBevelNone ' Remove o efeito de "bot√£o de vidro"
    ```

### 3. Limpeza de Camadas (O Fim dos Filtros Fantasmas)
Para que o estado "Ativo/Inativo" funcione, precisamos garantir que s√≥ exista **UM** conjunto de bot√µes na Sidebar.
*   **A√ß√£o**: A macro `Render_Sidebar` deve come√ßar com um "Delete" em todos os shapes que come√ßam com "btn_filter_".
*   **Por que?**: Se voc√™ clicar 5 vezes, ter√° 5 bot√µes empilhados. O VBA pode estar mudando a cor do bot√£o n¬∫ 1 (que est√° no fundo), enquanto voc√™ continua vendo o bot√£o n¬∫ 5 (que √© azul e est√° no topo).
*   **Snippet**:
    ```vba
    ' No in√≠cio do Render_Sidebar:
    For Each s In ws.Shapes
        If s.Name Like "btn_filter_*" Then s.Delete
    Next s
    ```