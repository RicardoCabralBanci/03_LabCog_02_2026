# Ferramentas de Correção de Botões (VBA)

Este arquivo consolida os scripts desenvolvidos para corrigir os links dos botões de navegação após a clonagem das planilhas (PCK -> DPL/DPK).

Cole estes códigos em um módulo temporário no VBA, execute conforme a necessidade e depois remova.

---

## 1. Corretor Smart V2 (Recomendado)
*Detecta a sigla da máquina e remove macros de auto-referência.*

```vba
Sub CorrigirBotoes_Smart_V2()
    Dim shp As Shape
    Dim macroFull As String, macroNome As String
    Dim siglaNova As String, novaMacro As String
    Dim padroesAntigos As Variant
    Dim i As Integer, contador As Integer, removidos As Integer
    Dim numeroPaginaMacro As String
    Dim numeroPaginaAtual As String
    
    ' 1. Detectar Sigla Nova (3 primeiras letras)
    siglaNova = UCase(Left(ActiveSheet.Name, 3))
    
    ' 2. Detectar Página Atual (Lógica Simplificada)
    If InStr(ActiveSheet.Name, "Estrutura") > 0 Then numeroPaginaAtual = "1"
    If InStr(ActiveSheet.Name, "Gerais") > 0 Then numeroPaginaAtual = "2"
    If InStr(ActiveSheet.Name, "Técnicos") > 0 Then numeroPaginaAtual = "3"
    If InStr(ActiveSheet.Name, "Elétricos") > 0 Then numeroPaginaAtual = "4"
    If InStr(ActiveSheet.Name, "IHM") > 0 Then numeroPaginaAtual = "5"
    
    padroesAntigos = Array("PCK", "PLT", "DPL", "DPK", "BTR", "GTR", "DVD", "PET", "CIP", "CMX", "CCMX")
    
    If MsgBox("Configuração Detectada:" & vbNewLine & _
              "Sigla: " & siglaNova & vbNewLine & _
              "Página Atual (Identificada): PG" & numeroPaginaAtual & vbNewLine & vbNewLine & _
              "Vou corrigir as siglas e REMOVER macros que apontem para PG" & numeroPaginaAtual & "." & vbNewLine & _
              "Confirmar?", vbQuestion + vbYesNo, "Corretor Smart V2") = vbNo Then Exit Sub
    
    contador = 0
    removidos = 0
    
    For Each shp In ActiveSheet.Shapes
        macroFull = shp.OnAction
        
        If macroFull <> "" Then
            If InStr(macroFull, "!") > 0 Then macroNome = Split(macroFull, "!")(1) Else macroNome = macroFull
            
            ' Verifica se é macro de navegação (PG + Numero)
            If InStr(macroNome, "PG") > 0 And IsNumeric(Right(macroNome, 1)) Then
                For i = LBound(padroesAntigos) To UBound(padroesAntigos)
                    If InStr(1, macroNome, padroesAntigos(i), vbTextCompare) = 1 Then
                        numeroPaginaMacro = Right(macroNome, 1) 
                        
                        If numeroPaginaMacro = numeroPaginaAtual Then
                            shp.OnAction = ""
                            removidos = removidos + 1
                        Else
                            novaMacro = siglaNova & "PG" & numeroPaginaMacro
                            If novaMacro <> macroNome Then
                                shp.OnAction = novaMacro
                                contador = contador + 1
                            End If
                        End If
                        Exit For
                    End If
                Next i
            End If
        End If
    Next shp
    
    MsgBox "Concluído!" & vbNewLine & "Redirecionados: " & contador & vbNewLine & "Removidos: " & removidos, vbInformation
End Sub
```

---

## 2. Corretor Manual Específico (Caso DPL Técnicos)
*Usa os nomes exatos dos Shapes para forçar a correção quando a automação falha.*

```vba
Sub Arrumar_DPL_Tecnicos_Na_Marra()
    Dim ws As Worksheet
    Set ws = ActiveSheet
    
    If MsgBox("Vou forçar as macros dos botões 3, 4 e 6 na aba atual.", vbYesNo) = vbNo Then Exit Sub
    
    On Error Resume Next
    ws.Shapes("Round Same Side Corner Rectangle 4").OnAction = "DPLPG1" ' Esquerda
    ws.Shapes("Round Same Side Corner Rectangle 3").OnAction = "DPLPG2" ' Meio
    ws.Shapes("Round Same Side Corner Rectangle 6").OnAction = "DPLPG3" ' Direita (Mantém ou remove)
    ws.Shapes("Round Same Side Corner Rectangle 5").OnAction = ""       ' Fantasma
    On Error GoTo 0
    
    MsgBox "Correção Manual Aplicada.", vbInformation
End Sub
```

---

## 3. Corretor por Posição (Experimental)
*Ordena da esquerda para a direita. Use com cautela se houver botões invisíveis.*

```vba
Sub CorrigirBotoes_Por_Posicao()
    ' ... (Código omitido para brevidade, usar apenas se necessário e com ambiente limpo)
    MsgBox "Use o Smart V2 preferencialmente.", vbExclamation
End Sub
```
