# Registro de Decisões de Arquitetura (ADR)

**Projeto**: Gerador Automático de Manuais  
**Data**: 30/01/2026  
**Autor**: Mestre em VBA

---

## ADR-001: Persistência de Dados (Excel Tables vs CSV vs SQLite)

### Contexto
Precisamos armazenar dados estruturados (Catálogo de IHMs, Configurações, Assets de Preview) que serão consumidos tanto pela UI moderna (C#) quanto pelo legado (VBA).

### Opções Avaliadas

#### 1. Arquivos CSV Externos
*   **Prós**: Leitura extremamente rápida em C# (`System.IO`).
*   **Contras**: Quebra a portabilidade "Single File". Exige distribuir uma pasta de dados junto com a planilha. Problemas de encoding (UTF-8 vs ANSI) e delimitadores regionais (`;` vs `,`).
*   **Performance**: Excelente.

#### 2. SQLite Embutido
*   **Prós**: SQL real, relacionamentos fortes, integridade.
*   **Contras**: Exige DLLs extras (`System.Data.SQLite`). Complexidade de deployment (extrair DLL nativa x86/x64). Exagero para < 500 registros.
*   **Performance**: Excelente.

#### 3. Tabelas Excel (ListObjects) - **ESCOLHIDA**
*   **Prós**:
    *   **Portabilidade**: Os dados viajam dentro do arquivo `.xlsm`. Zero dependências externas.
    *   **Manutenção**: Um usuário avançado pode editar os dados abrindo o Excel (se tiver a senha), sem precisar de ferramentas de DB.
    *   **Integração**: Nativa com o código VBA legado.
*   **Contras**:
    *   **Performance**: Leitura via Interop (C# -> Excel) é lenta comparada a CSV.
*   **Mitigação**: O volume de dados esperado (< 100 IHMs) torna a lentidão imperceptível para humanos (ms vs 200ms).

### Decisão
Utilizar **Abas Ocultas (`xlSheetVeryHidden`)** contendo **Tabelas Nomeadas (`ListObjects`)**.
*   Tabela Mestra: `tbl_IHM_Models`
*   Tabela Auxiliar: `tbl_IHM_Preview_Assets`

---

## ADR-002: Otimização Futura (Roadmap)

Se o catálogo de IHMs crescer exponencialmente (> 10.000 itens) ou a performance de inicialização da UI se tornar um problema, a migração deve seguir esta ordem:

1.  **Nível 1 (Código)**: Manter os dados no Excel, mas alterar a leitura do C# de `Interop` para **OpenXML SDK**.
    *   *Por que*: OpenXML lê o arquivo `.xlsx` como um ZIP, sem abrir o processo do Excel. É quase tão rápido quanto CSV.
2.  **Nível 2 (Arquitetura)**: Migrar para **SQLite Embedded**.
    *   *Por que*: Apenas se precisarmos de queries complexas (JOINs pesados) que o LINQ in-memory não aguente.

---

## ADR-003: Identificadores (IDs)
Decidido abandonar Strings (`CL_30`) como Chave Primária em favor de **Inteiros (Auto-Increment)**.
*   **Motivo**: Melhor performance de busca e integridade referencial.
*   **Manutenção**: Manter coluna `Codigo_Ref` (String) apenas para leitura humana e debug.
