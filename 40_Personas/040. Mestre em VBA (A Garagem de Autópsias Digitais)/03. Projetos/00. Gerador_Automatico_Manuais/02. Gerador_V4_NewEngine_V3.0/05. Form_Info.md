Attribute VB_Name = "Info"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False

' ==========================================================================================
' FORMULÁRIO: Info (Informações Gerais / PopUp)
' FUNÇÃO: Coletar dados iniciais do projeto (Cliente, SAP, Máquina).
' INTERFACE: Baseada em imagens (Image_MouseDown) simulando botões.
' FONTE DE DADOS: Planilha2 (Intervalo A22:A31 originalmente).
' ==========================================================================================

Private Sub ComboBox1_Change()
    Me.Image19.Visible = True
End Sub

Private Sub Image17_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
    ' BOTÃO "SALVAR/CONFIRMAR" (Simulado)
    With Planilha2
        .Range("B3").Value = Info.Projeto
        .Range("B4").Value = Info.SapNr
        .Range("B5").Value = Info.Revisao
        
        ' Lógica condicional para campos de máquina
        If Me.ComboBox1.Value = "BTR" Or Me.ComboBox1.Value = "GTR" Or Me.ComboBox1.Value = "GTR" Then
            .Range("B6").Value = "-"
            .Range("B8").Value = "-"
        Else
            .Range("B6").Value = Info.NrMaquina
            .Range("B8").Value = Info.Maquina
        End If
        
        .Range("B7").Value = Info.Ano
        .Range("B9").Value = Info.Cliente
        .Range("A20").Value = Info.ComboBox1.Value ' Salva a escolha da máquina em A20
    End With
    Me.Hide
End Sub

Private Sub Image19_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
    Me.ComboBox1.DropDown
    Me.Image19.Visible = False
End Sub

Private Sub Image18_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
    Me.Image19.Visible = True
    Me.ComboBox1.SetFocus
    SendKeys "{TAB}"
End Sub

Private Sub Image1_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
    Me.Image19.Visible = True
End Sub

Private Sub Image20_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
    ' LÓGICA VISUAL COMPLEXA
    ' Esconde/Mostra campos dependendo da seleção da máquina (via índice da lista)
    Dim ff As Long
    
    Planilha2.Range("B22:B40").ClearContents
    ff = Me.ComboBox1.ListIndex
    Planilha2.Cells(ff + 22, 2).Value = "x" ' Marca um X na Planilha2 ao lado da máquina escolhida?
    Me.ScrollTop = 110
    
    ' Verifica se a máquina escolhida tem flags nas colunas B (linhas 22, 23, 24)
    If Planilha2.Cells(22, 2) <> "" Or Planilha2.Cells(23, 2) <> "" Or Planilha2.Cells(24, 2) <> "" Then
        ' Modo Compacto (Esconde campos de máquina)
        Me.Height = 320
        Me.Image17.top = 340
        Me.Label5.Visible = False
        Me.Label7.Visible = False
        Me.Image9.Visible = False
        Me.Image10.Visible = False
        Me.NrMaquina.Visible = False
        Me.Maquina.Visible = False
        Me.Image13.Visible = False
        Me.Image14.Visible = False
    Else
        ' Modo Completo
        Me.Height = 400
        Me.Label5.Visible = True
        Me.Label7.Visible = True
        Me.Image9.Visible = True
        Me.Image10.Visible = True
        Me.NrMaquina.Visible = True
        Me.Maquina.Visible = True
        Me.Image13.Visible = True
        Me.Image14.Visible = True
        Me.Image17.top = 410
    End If
    Me.Repaint
End Sub

Private Sub Image21_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
    Me.ScrollTop = 0
    Me.Height = 150
    Me.Repaint
End Sub

Private Sub UserForm_Activate()
    Dim an As Integer
    Application.ScreenUpdating = False
    
    With Planilha2
        ' Recupera dados anteriores se existirem
        If .Range("B1").Value <> "" Then
            an = MsgBox("Foram encontradas informações de projeto já preenchidas, deseja manter?", vbQuestion + vbYesNo, "Informações já preenchidas")
            If an = vbYes Then
                Info.Projeto = .Range("B3").Value
                Info.SapNr = .Range("B4").Value
                Info.Revisao = .Range("B5").Value
                Info.NrMaquina = .Range("B6").Value
                Info.Ano = .Range("B7").Value
                Info.Maquina = .Range("B8").Value
                Info.Cliente = .Range("B9").Value
            Else
                .Range("B3:B9").ClearContents
            End If
        End If
        .Range("B1").ClearContents
        
        Dim ws As Worksheet
        Set ws = ThisWorkbook.ActiveSheet
        Application.EnableEvents = False
        Planilha2.Activate
        
        ' --- PONTO DE ALTERAÇÃO V3 ---
        ' Define a fonte da lista de máquinas.
        ' Expandir este range se adicionar PLT/PCK na Planilha2.
        Me.ComboBox1.RowSource = Planilha2.Range("A22:A31").Address 'Change when adding models
        
    End With
    ws.Activate
    Application.EnableEvents = True
    Application.ScreenUpdating = True
End Sub

Private Sub UserForm_Click()
    Me.Image19.Visible = True
End Sub

Private Sub UserForm_Initialize()

   ' === CORREÇÃO DE DPI / ESCALA (V3) ===

   Me.Zoom = 100

   Me.Width = 320   ' Ajustado para evitar cortes na interface

   Me.Height = 180  ' Altura inicial (modo compacto)

   

   ' Forçar redimensionamento automático de rótulos para evitar cortes de texto

   Dim ctl As Control

   On Error Resume Next

   For Each ctl In Me.Controls

       If TypeName(ctl) = "Label" Then ctl.AutoSize = True

   Next ctl

   On Error GoTo 0

   ' =====================================



   Me.top = Application.top + (Application.UsableHeight / 2) - (Me.Height / 2)

   Me.Left = Application.Left + (Application.UsableWidth / 2) - (Me.Width / 2)

End Sub
