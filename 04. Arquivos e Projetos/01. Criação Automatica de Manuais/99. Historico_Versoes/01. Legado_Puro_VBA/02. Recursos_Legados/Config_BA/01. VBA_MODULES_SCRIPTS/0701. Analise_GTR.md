# Análise Técnica: Módulo GTR (0700)
**Referência:** `0700. Script_GTR.md`
**Tipo:** Gerador de Documentos (Word Automation)
**Status:** Legado / Crítico (Apresentando Erros)

---

## 1. Objetivo do Módulo
Geração de manuais para transportadores **GTR**. É um clone funcional do módulo BTR, mas configurado para uma faixa de dados diferente na planilha mestre.

## 2. Dependências Específicas
*   **Planilha3 (Configuração)**:
    *   **Intervalo de Leitura**: Linhas **142 a 271** (Diferente do BTR que usa 5-138).
    *   **Flag de IHM**: Verifica a célula **B144** (BTR usa B7).
*   **Tabelas (Planilhas de Dados)**:
    *   Usa **Planilha16**, **Planilha17**, **Planilha18** e **Planilha15**.
    *   **Risco**: Se estas planilhas não existirem ou estiverem com nomes diferentes no arquivo Excel, o código falha silenciosamente e cai no erro "Infelizmente um erro ocorreu :(".

## 3. Fluxo de Execução e Diferenças Chave

1.  **Definição de Intervalo**: O loop percorre capítulos da linha 142 até 271.
2.  **Lógica de IHM**:
    *   Se `B144 = "Yes"`, o script pula capítulos específicos (`Case 145 To 193, 232 To 270`).
    *   Se houver um erro de digitação na célula B144 (ex: "yes " com espaço), a lógica falha.
3.  **Substituição de Tabelas (`TableSub`)**:
    *   **Erro de Encoding (Linha 251)**: O código busca por `If oTable.Title = "reas e segmentos"`. O caractere corrompido `` impedirá que a tabela de "Áreas e Segmentos" seja processada corretamente se o Word estiver com o nome acentuado.
    *   **Tabela de Embalagens**: Busca por "Tipos de embalagens grupadas" usando dados da `Planilha15`.

## 4. Diagnóstico do Erro Identificado
O usuário relatou o erro: *"Infelizmente um erro ocorreu :("* e *"Aguardando ação OLE"*.

### Causa Provável 1: Desalinhamento da Planilha3
Se o usuário adicionou ou removeu linhas na `Planilha3` acima da linha 142, o script estará lendo capítulos errados ou tentando abrir arquivos cujos caminhos estão em células vazias.

### Causa Provável 2: Loop Infinito no Word (OLE)
O Word pode estar exibindo uma mensagem de "O arquivo 'X' já está aberto" ou "Deseja salvar as alterações?". Como o Excel está em `Application.Visible = False`, essa mensagem fica invisível, o Excel fica esperando a resposta, e o Windows gera o erro de OLE.

### Causa Provável 3: Planilhas de Tabelas Ausentes
Diferente do BTR, o GTR aponta para planilhas de numeração alta (`Planilha15` a `Planilha18`). Em arquivos Excel novos ou mal importados, essas abas podem não existir.

## 5. Recomendações de Migração
*   **Parametrização**: O GTR não deveria ser um módulo separado, mas sim o mesmo código do BTR recebendo parâmetros de `StartRow` e `EndRow`.
*   **Tratamento de Erro**: O `On Error GoTo CloseEverything` deve ser removido durante o desenvolvimento para que o erro real seja exibido.
