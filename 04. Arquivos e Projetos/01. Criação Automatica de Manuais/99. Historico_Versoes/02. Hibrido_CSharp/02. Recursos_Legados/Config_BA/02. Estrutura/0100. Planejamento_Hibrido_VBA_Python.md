# 0100. Planejamento de Migração Híbrida

**Status**: Proposta de Arquitetura
**Objetivo**: Substituir o motor legado em VBA (`GTR.bas` e outros) por um sistema Python de alta performance, mantendo a fidelidade visual via Automação COM.

---

## 1. Arquitetura do Sistema: "O Funil"

A nova estrutura será dividida em três fases distintas:

### Fase A: Extração e Lógica (Python Puro)
*   **Ferramentas**: `pandas`, `openpyxl`.
*   **Ação**: Ler as planilhas de configuração (`Planilha3`, `Planilha4`, etc.).
*   **Melhoria**: Eliminar "Magic Numbers". O script lerá tabelas nomeadas ou buscará cabeçalhos, tornando o sistema imune a inserções de linhas/colunas.

### Fase B: Montagem Estrutural (Python Puro - XML Direct)
*   **Ferramentas**: `python-docx`, `docxcompose`.
*   **Ação**: 
    1.  Abrir o template base `manual.dotm`.
    2.  Realizar o loop de inserção de capítulos (o que o `Manual` faz hoje).
    3.  Gerar as tabelas dinâmicas diretamente no XML (Substituindo o `TableSub`).
*   **Vantagem**: Velocidade 100x superior. Sem uso de Clipboard (Área de Transferência), eliminando erros de conflito.

### Fase C: Finalização Estética (Python + COM Automation)
*   **Ferramentas**: `pywin32` (win32com.client).
*   **Ação**:
    1.  Abrir o documento gerado na Fase B de forma invisível no Word.
    2.  Comando `ActiveDocument.Fields.Update` (Atualizar Sumários e Propriedades).
    3.  Executar a lógica de "Página Ímpar" para capítulos e "Páginas em Branco".
    4.  Exportar PDF final.
    5.  Fechar o Word.

---

## 2. Mapa de Substituição de Funções (`GTR.bas`)

| Função VBA | Destino em Python | Estratégia |
| :--- | :--- | :--- |
| `createDoc` | `docx.Document()` | Criar via biblioteca, sem diálogos bloqueantes. |
| `Manual (Loop)` | `for index, row in df.iterrows():` | Iteração sobre DataFrame do Pandas. |
| `InsertFile` | `docxcompose` | Mesclar documentos em nível de arquivo/XML. |
| `TableSub` | `table = doc.add_table()` | Criar tabelas programaticamente com dados do Pandas. |
| `Wait` | **ELIMINADO** | Não será necessário esperar o Word processar cada clique. |
| `UpdateTOC` | `objword.ActiveDocument.TablesOfContents(1).Update` | Chamada COM única no final do processo. |

---

## 3. Próximos Passos (Sprint 1)

1.  **Mapeamento de Dados**: Criar um dicionário de dados que represente todas as variáveis lidas do Excel.
2.  **Protótipo de Tabela**: Recriar a lógica da função `TableSub` (Tabela de "Componentes Integrados") usando Python Puro para provar que o Clipboard não é necessário.
3.  **Script de "Toque Final"**: Criar um script Python que apenas abre um Word existente, atualiza o sumário e fecha, validando a integração COM via Python.

---

## 4. Riscos Identificados
*   **Estilos de Parágrafo**: O Python precisa garantir que os nomes dos estilos (`Título 1`, `Normal`) coincidam exatamente com o `manual.dotm`.
*   **Referências Cruzadas**: Se o documento original tiver links quebrados, o Word pode exibir diálogos de erro durante a atualização final.

---
*Assinado,*
**Mestre em VBA** (O Arquiteto Cínico)
